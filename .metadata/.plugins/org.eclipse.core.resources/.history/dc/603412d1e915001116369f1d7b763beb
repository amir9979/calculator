
package calculations.dev.parseservice;

import org.ebayopensource.turmeric.runtime.common.exceptions.ServiceException;

import calculations.dev.NegateRequest;
import calculations.dev.ParseRequest;
import calculations.dev.ParseResponse;
import calculations.dev.PowerRequest;
import calculations.dev.multiplyservice.MultiplyServiceConsumer;
import calculations.dev.multiplyservice.gen.SharedMultiplyServiceConsumer;
import calculations.dev.negateservice.NegateServiceConsumer;
import calculations.dev.negateservice.gen.SharedNegateServiceConsumer;
import calculations.dev.powerservice.PowerServiceConsumer;
import calculations.dev.powerservice.gen.SharedPowerServiceConsumer;
import calculations.dev.sumservice.SumServiceConsumer;
import calculations.dev.sumservice.gen.SharedSumServiceConsumer;

public class ParseServiceImpl
    implements ParseService
{


    public ParseResponse parse(ParseRequest param0) {
    	ParseResponse response = new ParseResponse();
    	String calculation = param0.getInput();
		int x, y;
		
		try {

			SharedPowerServiceConsumer powerConsumer = new SharedPowerServiceConsumer("ParseService");
			SharedMultiplyServiceConsumer multiplyConsumer = new SharedMultiplyServiceConsumer("ParseService");
			SharedSumServiceConsumer sumConsumer = new SharedSumServiceConsumer("ParseService");
			SharedNegateServiceConsumer negateConsumer = new SharedNegateServiceConsumer("ParseService");
			
		if(calculation.contains("+")) {
			String[] splitstring = calculation.split("[+]");
			x = Integer.parseInt(splitstring[0]);
			y = Integer.parseInt(splitstring[1]);
			response.setOutput(SumServiceConsumer.sum(x,y));
		} else if (calculation.contains("*")) {
			String[] splitstring = calculation.split("[*]");
			x = Integer.parseInt(splitstring[0]);
			y = Integer.parseInt(splitstring[1]);
			response.setOutput(MultiplyServiceConsumer.multiply(x,y));	
		} else if (calculation.contains("^")) {
			String[] splitstring = calculation.split("[\\^]");
			x = Integer.parseInt(splitstring[0]);
			y = Integer.parseInt(splitstring[1]);
			PowerRequest request = new PowerRequest();
			request.setX(x);
			request.setY(y);
			response.setOutput(powerConsumer.power(request).getZ());				
		} else if (calculation.contains("-")) {
			String[] splitstring = calculation.split("[\\-]");
			x = Integer.parseInt(splitstring[1]);
			NegateRequest request = new NegateRequest();
			request.setX(x);
			response.setOutput(negateConsumer.negate(request).getY());
		} else {
			x = Integer.parseInt(calculation);
			response.setOutput(x);
		}
			
		} catch (ServiceException e) {
			e.printStackTrace();
		}
			
    	return response;
    }

}
